<% if controller_name == 'layers' %>
<%= link_to 'Back', layers_path %> |
<%= link_to  @permalink, @permalink %>
<% end %>
<div id="map"></div>
<script type="text/javascript">
$(document).ready(function(){
  // var map = L.map('map').setView([51.505, -0.09], 13);
  // New York
  // var map = L.map('map').setView([40.713955826286046, -73.99703979492188], 13);
  // Denver, State view
  //var map = L.map('map').setView([39.7392, -104.9842], 5);
  var data_json = <%= raw @data_json %>
  var viewPoint = data_json['view_point'];
  var map = L.map('map').setView(viewPoint, 11);

  pointsCounts = data_json['points_counts_array'];

  var colorGroup = getColorGroup(pointsCounts);

  var areasLayer = new L.LayerGroup();
  var area_points = data_json['area_points'];
  var points_count = data_json['points_count']
  for(k in area_points) {
    if(area_points.hasOwnProperty(k)) {
      var points = area_points[k];
      var pointsCount = points_count[k];
      addArea(areasLayer, points, pointsCount, colorGroup);
    }
  }

  init(map, colorGroup, {"baseLayers":{}, "overLayers": {"Polygon Layer": areasLayer} });
});

</script>
