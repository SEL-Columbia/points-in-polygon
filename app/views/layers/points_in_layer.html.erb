<%= link_to 'Back', layers_path %>
<div id="map"></div>
<script type="text/javascript">
$(document).ready(function(){
  // var map = L.map('map').setView([51.505, -0.09], 13);
  // New York
  // var map = L.map('map').setView([40.713955826286046, -73.99703979492188], 13);
  // Denver, State view
  var map = L.map('map').setView([39.7392, -104.9842], 5);

  // add a CloudMade tile layer with style #997
  L.tileLayer('http://{s}.tile.cloudmade.com/42c6e747565540068a4bb4ad883f1f41/997/256/{z}/{x}/{y}.png', {
      attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
  }).addTo(map);

  <% @layer.areas.each do |area| %>
    <% points_count = area.get_points_count(@result) %>
    L.polygon(<%= (Area::RGEO_FACTORY.unproject area.polygon.exterior_ring).points.map {|point| [point.y, point.x]} %>, style(<%= points_count %>)).addTo(map);
  <% end %>
});

</script>
